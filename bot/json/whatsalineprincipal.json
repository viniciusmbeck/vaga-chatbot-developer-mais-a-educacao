{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"aada68ed-c451-4dd8-8ee5-f5c305bea9cd","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:891"}],"$conditionOutputs":[{"stateId":"a14d4d76-7c10-4f99-a831-48b7202f6733","typeOfStateId":"state","$connId":"con_3","$id":"181f5b6e-8eeb-4367-b128-24b4ac9c2a12","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:914"}],"$isBuilderDefaultOutput":true,"$invalid":false,"$$hashKey":"object:896"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5dcd6e16-a53a-43a8-8e3f-16c677e6dc68","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountWeCanContinue","$invalid":false,"settings":{"variable":"exceptionErrorCountWeCanContinue"},"conditions":[]},{"$id":"f0fb36ff-366d-4a66-ac2e-80d97b4aa587","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectName","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectName"},"conditions":[]},{"$id":"1a3e9576-5fff-4b89-813f-55790d04a0fd","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"MergeContact","$title":"update coantactPhoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"5553981371243"},"conditions":[]},{"$id":"1131d646-7d9e-4522-aad5-e7b1b6fef5a4","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountIdentifiedPhone","$invalid":false,"settings":{"variable":"exceptionErrorCountIdentifiedPhone"},"conditions":[]},{"$id":"66e842fe-2066-45a0-8ebc-73b294f0b210","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectPhone","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectPhone"},"conditions":[]},{"$id":"7f98623a-c8a7-4aac-8925-0bf322ee71dc","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectCpf","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectCpf"},"conditions":[]},{"$id":"2df3bf1b-af54-4329-ba89-6bc0e51446a6","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectEducationLevel","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectEducationLevel"},"conditions":[]},{"$id":"9d26c9ae-3bb5-48fc-96f5-1d603286f4c2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectArea","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectArea"},"conditions":[]},{"$id":"b572c3fd-73ba-4cb7-a310-14125424670a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountCollectCourse","$invalid":false,"settings":{"variable":"exceptionErrorCountCollectCourse"},"conditions":[]},{"$id":"9514ace7-2e25-4d99-b0a5-d4e1ae940d07","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountFriendRecommendation","$invalid":false,"settings":{"variable":"exceptionErrorCountFriendRecommendation"},"conditions":[]},{"$id":"e0000a8e-16a6-465d-aeca-7e6da67fb7d3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountWorksInTheArea","$invalid":false,"settings":{"variable":"exceptionErrorCountWorksInTheArea"},"conditions":[]},{"$id":"7de59398-19c0-48f4-91ad-ad05c44579ea","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"reset exceptionErrorCountAskRegistration","$invalid":false,"settings":{"variable":"exceptionErrorCountAskRegistration"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a14d4d76-7c10-4f99-a831-48b7202f6733","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"In√≠cio","$position":{"top":"70px","left":"335px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"526fc45f-2762-4f92-9d8c-43e2933e6ee8","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_8","$id":"50ebb848-6c1c-494e-b2a2-df26c5e54369","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"fallback","$title":"Exce√ß√µes","$position":{"top":"869px","left":"308px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a14d4d76-7c10-4f99-a831-48b7202f6733":{"$contentActions":[{"action":{"$id":"81b6f4e5-5211-48bc-8d33-0425c32c0f54","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"cd30f70e-f2d5-42a8-bba8-d1719e5f8782","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cd30f70e-f2d5-42a8-bba8-d1719e5f8782","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1018"},{"action":{"$id":"d190da8c-798f-420a-8b2e-65c0d1d8f3d0","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"6aa653d2-681b-43c8-92c2-a291ca3cbdd3","type":"text/plain","content":"Ol√°! Eu sou a Aline, a assistente acad√™mica virtual da +A Educa√ß√£o!","metadata":{}},"$cardContent":{"document":{"id":"6aa653d2-681b-43c8-92c2-a291ca3cbdd3","type":"text/plain","content":"Ol√°! Eu sou a Aline, a assistente acad√™mica virtual da +A Educa√ß√£o!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1019"},{"action":{"$id":"75790715-f8bd-4d2b-b707-60ca32fe4125","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"0bda111d-2fac-4304-b121-80e51775dfc2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0bda111d-2fac-4304-b121-80e51775dfc2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1020"},{"action":{"$id":"adc2fe36-1e53-4d99-a1b9-53cf1a787ea0","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"c95062d3-cadb-462d-8111-922d857726f1","type":"text/plain","content":"Estou aqui para te ajudar a encontrar o curso de Gradua√ß√£o ou P√≥s-Gradua√ß√£o que mais combina com voc√™.","metadata":{}},"$cardContent":{"document":{"id":"c95062d3-cadb-462d-8111-922d857726f1","type":"text/plain","content":"Estou aqui para te ajudar a encontrar o curso de Gradua√ß√£o ou P√≥s-Gradua√ß√£o que mais combina com voc√™."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1021"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"314c35f2-7455-478a-8c0f-8fd6621b3e45","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1022"}],"$conditionOutputs":[{"stateId":"d69e232f-85ab-43f4-9968-b4dc84e0cf8c","typeOfStateId":"state","$connId":"con_13","$id":"afda9396-a813-4c3d-9420-5d6ecc63b216","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1052"}],"$isBuilderDefaultOutput":true,"$invalid":false,"$$hashKey":"object:1034"}],"$enteringCustomActions":[{"$id":"c00af348-a14a-48e1-92ab-701e4a3a91e7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set default friendRecommendation","$invalid":false,"settings":{"variable":"friendRecommendation","value":"false"},"conditions":[]},{"$id":"68335b73-9d25-4abb-9af1-4dad852df63f","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set default worksInTheArea","$invalid":false,"settings":{"variable":"worksInTheArea","value":"false"},"conditions":[]},{"$id":"6f0f7deb-1738-493f-a208-5944c90bfe7a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set default recurringPayment","$invalid":false,"settings":{"variable":"recurringPayment","value":"false"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d69e232f-85ab-43f4-9968-b4dc84e0cf8c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false}],"id":"a14d4d76-7c10-4f99-a831-48b7202f6733","root":false,"$title":"[sauda√ß√£o] Apresenta√ß√£o","$position":{"top":"194px","left":"336px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d69e232f-85ab-43f4-9968-b4dc84e0cf8c":{"$contentActions":[{"action":{"$id":"c68cf2d5-d86d-499f-b3ad-857a75aa9806","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0794ac8-28d0-4bc1-a508-adbd16ed4426","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Podemos seguir com as recomenda√ß√µes de cursos?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Podemos seguir com as recomenda√ß√µes de cursos?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8eeac3e6-b809-40f3-93d7-3667674fc517","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ffd46c96-755c-449f-b5ec-9471e42bb4aa","typeOfStateId":"state","$connId":"con_18","$id":"bb9d88da-b1ec-4622-9a58-6892b1ea0499","conditions":[{"source":"context","comparison":"equals","values":["SIM"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"fa929d8e-f664-43f9-a1f4-f2a5bf822015","typeOfStateId":"state","$connId":"con_23","$id":"9eec9bb4-d1e3-40c8-98ca-d85aa553b5c1","conditions":[{"source":"context","comparison":"equals","values":["N√ÉO"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_28","$id":"f003f47d-36e6-4266-b2ad-cd55f9848cbf","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountWeCanContinue","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_33","$id":"030aec0c-26bb-476c-aaf7-2ce0f20e1e7a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"e6aa16ad-b6eb-4287-a96a-fa963d1fdf6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"weCanContinue"},"conditions":[]},{"$id":"3ae0c56d-8176-40d3-9324-dcbd952d79b3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"onboarding"},"conditions":[]}],"$leavingCustomActions":[{"$id":"10d5f27a-b57c-49f2-bee4-b5b5c2658cb3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751c1853-a282-4c2f-baaa-c8e05963fae1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountWeCanContinue","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountWeCanContinue"],"outputVariable":"exceptionErrorCountWeCanContinue","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"d69e232f-85ab-43f4-9968-b4dc84e0cf8c","root":false,"$title":"[optin] Podemos continuar?","$position":{"top":"309px","left":"335px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fa929d8e-f664-43f9-a1f4-f2a5bf822015":{"$contentActions":[{"action":{"$id":"19841c65-93cc-48bd-8f1b-8c4623d48214","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1c0d91e9-0f2c-4593-a7f3-e7d8acbff00a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1c0d91e9-0f2c-4593-a7f3-e7d8acbff00a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c37b7aa4-9848-4b78-a5a2-bb327f88ef4e","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1cf14b2c-a997-468c-bbdd-393bb5e56521","type":"text/plain","content":"Ah que pena!  üòî\nMas tudo bem, caso queira saber sobre as recomenda√ß√µes de cursos, √© s√≥ me chamar.","metadata":{}},"$cardContent":{"document":{"id":"1cf14b2c-a997-468c-bbdd-393bb5e56521","type":"text/plain","content":"Ah que pena!  üòî\nMas tudo bem, caso queira saber sobre as recomenda√ß√µes de cursos, √© s√≥ me chamar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4eb8e9b6-6bf2-4a44-99c2-e63de44120bc","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"61c84917-b6a9-4106-9f1d-ae83deec2af9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"61c84917-b6a9-4106-9f1d-ae83deec2af9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff95d0a3-d2d7-44dd-a1a1-9d3b55c3037d","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"46bf327f-48f2-4d4e-841b-062e21eb0629","type":"text/plain","content":"At√© mais! üëã","metadata":{}},"$cardContent":{"document":{"id":"46bf327f-48f2-4d4e-841b-062e21eb0629","type":"text/plain","content":"At√© mais! üëã"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a963e64-ba7a-4d32-ac96-7c36bde0b1be","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"fa929d8e-f664-43f9-a1f4-f2a5bf822015","root":false,"$title":"[encerramento] Decidiu n√£o seguir","$position":{"top":"449px","left":"333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ffd46c96-755c-449f-b5ec-9471e42bb4aa":{"$contentActions":[{"action":{"$id":"7b573528-7977-4311-aa91-7a2313cbbd23","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"bed1e95f-7788-4148-a797-a3074e94eacc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bed1e95f-7788-4148-a797-a3074e94eacc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f067651f-01df-49f7-bced-d1e13e43c460","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"55334321-6699-4bb1-b882-9310e934c1ba","type":"text/plain","content":"Que √≥timo! ü§©\nPara achar os cursos que mais combinam com seu perfil, preciso de algumas informa√ß√µes.","metadata":{}},"$cardContent":{"document":{"id":"55334321-6699-4bb1-b882-9310e934c1ba","type":"text/plain","content":"Que √≥timo! ü§©\nPara achar os cursos que mais combinam com seu perfil, preciso de algumas informa√ß√µes."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ee02e29e-3d21-4b84-b99a-6fdb3e124be8","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f1e93db1-9f24-4a54-ac14-2d390a4164ab","typeOfStateId":"state","$connId":"con_38","$id":"ed52b3d8-7611-49b1-933f-153d5d5d752c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f1e93db1-9f24-4a54-ac14-2d390a4164ab","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"ffd46c96-755c-449f-b5ec-9471e42bb4aa","root":false,"$title":"[dados] Necessidade de dados","$position":{"top":"194px","left":"524px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f1e93db1-9f24-4a54-ac14-2d390a4164ab":{"$contentActions":[{"action":{"$id":"0e1172f9-451e-47af-b1f1-9f5a277ca864","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"67cbccdf-a95e-407b-9d0c-46954ebc89ea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"67cbccdf-a95e-407b-9d0c-46954ebc89ea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"acae73b5-3ed6-48a0-8a81-d132d4533e49","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1620b8-ffbd-4956-a408-ef3c9f93fea4","type":"text/plain","content":"Qual √© o seu <b>nome completo</b>?","metadata":{}},"$cardContent":{"document":{"id":"af1620b8-ffbd-4956-a408-ef3c9f93fea4","type":"text/plain","content":"Qual √© o seu <b>nome completo</b>?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"6e3022d9-56ed-4637-bda1-5a65a90ced80","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e86c487b-ccbe-45d7-bfff-d844b32fc9c5","typeOfStateId":"state","$connId":"con_43","$id":"abfee945-1b3b-4313-a52a-cd5ec4271954","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isValidName"},{"source":"context","comparison":"equals","variable":"config.useChannelPhone","values":["true"]},{"source":"context","comparison":"exists","values":[],"variable":"contact.phoneNumber"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"df93d1ad-ff72-4299-b739-9a9a1c74fc01","typeOfStateId":"state","$connId":"con_48","$id":"f111d625-94f5-4d49-8f6a-8fad61026638","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isValidName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_53","$id":"2ecaa1de-54e7-4967-900e-2e059be56a19","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isValidName"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountCollectName","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_58","$id":"8e9c3758-ee87-4245-9056-ba9f1fdcef9a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"f00bc4f1-876b-4a77-bc2b-412e90b2d296","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"90db9276-0141-449c-9389-e857b83af7c2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectName"},"conditions":[]}],"$leavingCustomActions":[{"$id":"16b51c48-b6d5-44db-aceb-7696438645c5","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set isValidName","$invalid":false,"settings":{"function":"run","source":"const run = (fullName) => {\n    try {\n        const [firstName, secondName] = fullName.split(\" \");\n        if (!secondName) return false\n        if (firstName.length < 3 || secondName.length < 3) return false\n        return true\n    } catch (error) {\n        return false\n    }\n}","inputVariables":["input.content"],"outputVariable":"isValidName","LocalTimeZoneEnabled":false},"conditions":[{"source":"input","comparison":"exists","values":[]}]},{"$id":"0873b42a-5a53-4a6f-b070-2d43c2644c37","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectName","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectName"],"outputVariable":"exceptionErrorCountCollectName","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"isValidName","values":["false"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"f1e93db1-9f24-4a54-ac14-2d390a4164ab","root":false,"$title":"[dados] Coleta nome","$position":{"top":"330px","left":"524px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"df93d1ad-ff72-4299-b739-9a9a1c74fc01":{"$contentActions":[{"action":{"$id":"daa3c308-0600-4b61-b0b2-1f93e3be9e0b","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"923c3de7-a60b-4c5b-a6e6-af4220e3816f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"923c3de7-a60b-4c5b-a6e6-af4220e3816f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"62780ed4-984f-4b75-aef1-9f7b3212e755","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"dc588ea7-cbbf-47c1-aafe-45152482fe8d","type":"text/plain","content":"{{collectPhoneDynamicMessage}}","metadata":{}},"$cardContent":{"document":{"id":"dc588ea7-cbbf-47c1-aafe-45152482fe8d","type":"text/plain","content":"{{collectPhoneDynamicMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9a51ea03-1a51-4a83-b2f5-50c64a835b30","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8975008d-73f2-4187-a368-1a79ce60ea47","typeOfStateId":"state","$connId":"con_63","$id":"4e19020c-f40c-41ce-a693-862d3d2d5deb","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"phoneValidation@isValid"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_68","$id":"acdac111-6448-4147-87d2-c6b1fc59ab50","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"phoneValidation@isValid"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountCollectPhone","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_73","$id":"dffafc98-f7c7-4dbb-9161-a301d1a931f2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"bf9f1661-3b62-466b-98e2-e591cae19c5e","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"54448fab-cec3-4b1b-a3c4-622e81eb096a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectPhone"},"conditions":[]},{"$id":"7c519f5a-2030-4f44-a118-b79f66a51b26","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set collectPhoneDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    const defaultMessage = \"Certinho! Agora, por favor, me informe seu <b>n√∫mero de telefone:</b>\"\n    try {\n        const messageMap = {\n            \"identifiedPhone\": \"Sem problemas! Por favor, me informe <b>n√∫mero de telefone:</b>\",\n            \"collectPhone\": \"Por favor, me informe seu <b>n√∫mero de telefone:</b>\"\n        }\n        return stateName && messageMap[stateName] ? messageMap[stateName] : defaultMessage\n    } catch (error) {\n        return defaultMessage\n    }\n}","inputVariables":["lastState"],"outputVariable":"collectPhoneDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"055c714e-3031-417b-bfe0-8abc6348631a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set phoneValidation","$invalid":false,"settings":{"function":"run","source":"const run = (phoneNumber) => {\n    const defaultValidation = { isValid: false, phoneNumber: null }\n    try {\n        const onlyNumbers = phoneNumber.replace(/\\D+/g, '')\n        if (onlyNumbers.length != 13) return defaultValidation\n        const nineDigit = onlyNumbers.slice(4, 5)\n        if (nineDigit != 9) return defaultValidation\n        return { isValid: true, phoneNumber: onlyNumbers}\n    } catch (error) {\n        return defaultValidation\n    }\n}","inputVariables":["input.content"],"outputVariable":"phoneValidation","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ec045a9-201a-4364-a258-c4f50da680e1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectPhone","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectPhone"],"outputVariable":"exceptionErrorCountCollectPhone","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"phoneValidation@isValid","values":["false"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"df93d1ad-ff72-4299-b739-9a9a1c74fc01","root":false,"$title":"[dados] Coleta n√∫mero de telefone","$position":{"top":"609px","left":"520px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e86c487b-ccbe-45d7-bfff-d844b32fc9c5":{"$contentActions":[{"action":{"$id":"d40f4dbf-cf89-4121-ba1a-8d7e9ae30878","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4e21bc5c-e3b9-46d2-aec2-7208dac04a97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4e21bc5c-e3b9-46d2-aec2-7208dac04a97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8b9c25ab-9a01-456a-a017-5b080cd91783","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"55bb9039-05e3-40f3-a1cd-125fa03c88a3","type":"application/vnd.lime.select+json","content":{"text":"Identifiquei que voc√™ est√° falando do n√∫mero <b>{{contact.phoneNumber}}.</b> Podemos seguir com esse n√∫mero?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"55bb9039-05e3-40f3-a1cd-125fa03c88a3","type":"application/vnd.lime.select+json","content":{"text":"Identifiquei que voc√™ est√° falando do n√∫mero <b>{{contact.phoneNumber}}.</b> Podemos seguir com esse n√∫mero?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"88eedd78-8e8c-4db0-8997-5e22af045eb5","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8975008d-73f2-4187-a368-1a79ce60ea47","typeOfStateId":"state","$connId":"con_78","$id":"007e06e5-411f-4886-ad2c-ba092237708b","conditions":[{"source":"context","comparison":"equals","values":["SIM"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"df93d1ad-ff72-4299-b739-9a9a1c74fc01","typeOfStateId":"state","$connId":"con_83","$id":"ec9ba3c4-0a87-4e19-93f6-28b49334c076","conditions":[{"source":"context","comparison":"equals","values":["N√ÉO"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_88","$id":"cddb5c7f-5183-4309-b90a-e8f124a40e16","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountIdentifiedPhone","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_93","$id":"094eb2fc-82f1-42f5-b965-1be7a50bbf18","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"ad9a7b16-4832-4274-bbc3-e72732e1ca75","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"1fc2d00b-1e3c-44cd-9051-cdab87a61a57","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"identifiedPhone"},"conditions":[]},{"$id":"a6e9a03e-87b6-4c3b-af0c-36349e737d77","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"MergeContact","$title":"update coantactPhoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"5553981371243"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f4bd0fb5-0478-4583-9a9f-2e1dba1339a1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6fef985d-6196-4681-b9d3-238d84c9ae29","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountIdentifiedPhone","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountIdentifiedPhone"],"outputVariable":"exceptionErrorCountIdentifiedPhone","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false}],"id":"e86c487b-ccbe-45d7-bfff-d844b32fc9c5","root":false,"$title":"[dados] Telefone identificado","$position":{"top":"468px","left":"520px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8975008d-73f2-4187-a368-1a79ce60ea47":{"$contentActions":[{"action":{"$id":"15d82c09-cf7f-4a28-8c74-5c3b1743261d","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"00f5a013-0611-4ba2-bdad-1f641448b7b0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00f5a013-0611-4ba2-bdad-1f641448b7b0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5f80aec7-1556-4f06-893f-887b7cb50915","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"971f9d0a-2723-4e22-b254-ad796efe1cd1","type":"text/plain","content":"{{collectCpfDynamicMessage}}","metadata":{}},"$cardContent":{"document":{"id":"971f9d0a-2723-4e22-b254-ad796efe1cd1","type":"text/plain","content":"{{collectCpfDynamicMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e4a06317-f173-4620-802f-f187f820e23e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0dbbd906-3c0e-4adb-9795-071944bf5e7a","typeOfStateId":"state","$connId":"con_98","$id":"d901f2d6-a303-4aec-a77f-da7d42371734","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"cpfValidation@isValid"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_103","$id":"fbe5df53-f188-4f15-b78a-ce272db9b93e","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"cpfValidation@isValid"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountCollectCpf","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_108","$id":"4f360180-ca2b-4757-9d41-b99f00402a15","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"0539678c-4108-4a7e-8537-5b258e41edc4","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"b4d7aff3-f677-4389-b147-1a2382e92637","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectCpf"},"conditions":[]},{"$id":"aa715b4c-c5d2-489b-9eb0-94b3876784ed","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set collectCpfDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    const defaultMessage = 'Anotei aqui! üìù Agora, me informe qual √© o seu <b>CPF</b>:'\n    try {\n        return stateName && stateName === \"collectCpf\" ? 'Por favor, me informe seu <b>CPF</b>:' : defaultMessage\n    } catch (error) {\n        return defaultMessage\n    }\n}","inputVariables":["lastState"],"outputVariable":"collectCpfDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75d9fc19-1e6e-4125-8505-3db5be637e37","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"MergeContact","$title":"update userPhone","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneValidation@phoneNumber]}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"4fcb4dfc-ef70-4676-8b84-ec01df1e6f2a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set cpfValidation","$invalid":false,"settings":{"function":"run","source":"const run = (cpfInput) => {\n    const defaultValidation = { isValid: false, cpf: null }\n    try {\n        const cpf = cpfInput.replace(/\\D+/g, '')\n        if (cpf.length != 11) return defaultValidation\n        if(checkIfAllDigitsAreEqual(cpf)) return defaultValidation\n        const firstValidatorDigit = calculateValidatorDigit(cpf, 10)\n        const secondValidatorDigit = calculateValidatorDigit(cpf, 11)\n        if(firstValidatorDigit != parseInt(cpf[9]) || secondValidatorDigit != parseInt(cpf[10])) return defaultValidation\n        return { isValid: true, cpf }\n    } catch (error) {\n        return defaultValidation\n    }\n}\n\nconst calculateValidatorDigit = (cpf, startWeight) => {\n    let sum = 0;\n    for (let i = 0; i < startWeight - 1; i++) {\n        sum += parseInt(cpf[i]) * (startWeight - i);\n    }\n    let digit = (sum * 10) % 11;\n    return digit === 10 ? 0 : digit;\n\n}\n\nconst checkIfAllDigitsAreEqual = (cpf) => {\n    return /^(\\d)\\1{10}$/.test(cpf);\n}","inputVariables":["input.content"],"outputVariable":"cpfValidation","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fee70325-6c63-4f48-acd9-df7616f0bfe7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectCpf","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectCpf"],"outputVariable":"exceptionErrorCountCollectCpf","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"cpfValidation@isValid","values":["false"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false},{"background":"#ffcbdb","label":"MergeContact","id":"blip-tag-828cf8c8-9be5-bc5d-383c-98f1efd2bd0d","canChangeBackground":false}],"id":"8975008d-73f2-4187-a368-1a79ce60ea47","root":false,"$title":"[dados] Coleta CPF","$position":{"top":"195px","left":"716px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6d0f86cc-3db0-486f-800d-de534edb339c":{"$contentActions":[{"action":{"$id":"0f1c75ad-825a-4c8a-92f7-43aee0648780","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"bf1a9f95-c2e9-4c04-a449-1cb8e4b59381","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bf1a9f95-c2e9-4c04-a449-1cb8e4b59381","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5209f4c4-6f9c-4a48-b714-814da6f8d6d6","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"85069446-d9bf-4632-9c98-ef6c4abacae2","type":"text/plain","content":"Aguarde um pouquinho enquanto eu busco as informa√ß√µes do seu endere√ßo üîç","metadata":{}},"$cardContent":{"document":{"id":"85069446-d9bf-4632-9c98-ef6c4abacae2","type":"text/plain","content":"Aguarde um pouquinho enquanto eu busco as informa√ß√µes do seu endere√ßo üîç"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b953814d-0e08-4e75-9726-cdd0a14f0748","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b0e50305-0750-48f8-828b-20689b71c032","typeOfStateId":"state","$connId":"con_113","$id":"9845ab02-2c29-49ee-acfa-b8afecbd53a7","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"findCepStatus"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a4494a0f-a8f0-4a79-ae7e-23964c3bdc33","typeOfStateId":"state","$connId":"con_118","$id":"5fd4dff8-5c57-4899-b99c-63a0423d5318","conditions":[{"source":"context","comparison":"equals","values":["400"],"variable":"findCepStatus"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"0e68a24f-1baa-47b0-bee6-d688ce4a8865","typeOfStateId":"state","$connId":"con_123","$id":"243afd41-cb00-4e9c-9e73-4e1954c67431","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"371aaf25-d7c5-4f27-8485-793bcd261c87","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"586356b1-073f-4067-aedd-c102954cf3f2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"findCep"},"conditions":[]}],"$leavingCustomActions":[{"$id":"478684c5-9913-483b-8edf-eda46d8bc017","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ProcessHttp","$title":"findCep","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"{{config.apiCepBaseUrl}}/{{cepValidation@cep}}/json","responseStatusVariable":"findCepStatus","responseBodyVariable":"findCepResponse"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0e68a24f-1baa-47b0-bee6-d688ce4a8865","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#7762E3","label":"RequestHttp","id":"blip-tag-c614f341-2284-7d3c-8156-d4be147f5306","canChangeBackground":false}],"id":"6d0f86cc-3db0-486f-800d-de534edb339c","root":false,"$title":"[api] Consulta CEP","$position":{"top":"463px","left":"712px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b0e50305-0750-48f8-828b-20689b71c032":{"$contentActions":[{"action":{"$id":"3fe62076-fbd2-4606-a521-4afd17944b2a","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1a3819c6-aa46-4263-9333-eec42eef3485","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1a3819c6-aa46-4263-9333-eec42eef3485","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f3c369fe-ca5a-4220-853e-839bc5533c9a","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"704d494a-35f4-43a4-94c6-a6588b46f9e5","type":"application/vnd.lime.select+json","content":{"text":"{{collectEducationLevelDynamicMessage}}","scope":"immediate","options":[{"text":"Gradua√ß√£o","previewText":"Gradua√ß√£o","value":null,"index":0,"type":null},{"text":"P√≥s-Gradua√ß√£o","previewText":"P√≥s-Gradua√ß√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"704d494a-35f4-43a4-94c6-a6588b46f9e5","type":"application/vnd.lime.select+json","content":{"text":"{{collectEducationLevelDynamicMessage}}","scope":"immediate","options":[{"text":"Gradua√ß√£o","previewText":"Gradua√ß√£o","value":null,"index":0,"type":null},{"text":"P√≥s-Gradua√ß√£o","previewText":"P√≥s-Gradua√ß√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0d2d8117-e8cd-4d86-bf1a-48bd4ab33be5","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17b96932-f787-44f1-a090-545a7110d0db","typeOfStateId":"state","$connId":"con_128","$id":"53fe5b1c-da02-4c83-9adf-a06dbc72f5d9","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"educationLevel"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_133","$id":"eda5595b-92f2-4fc8-a884-60f6658d9dea","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"educationLevel"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountCollectEducationLevel","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_138","$id":"1bdcdae8-7227-4c23-bce2-613da55dd662","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"6fbb2969-d675-4e88-9f6d-89cc6c5e5be9","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e8cf5394-38d9-4f25-b1e3-f2241edd08d6","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectEducationLevel"},"conditions":[]},{"$id":"d1e39b90-58b8-45e7-9195-c11f036ba596","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set collectEducationLevelDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    const defaultMessage = 'Encontrei seu endere√ßo!\\nAgora, preciso saber qual √© o <b>n√≠vel de ensino</b> que voc√™ gostaria de obter recomenda√ß√µes:'\n    try {\n        return stateName && stateName === \"collectEducationLevel\" ? 'Por favor, me informe qual √© o <b>n√≠vel de ensino</b> que voc√™ gostaria de obter recomenda√ß√µes:' : defaultMessage\n    } catch (error) {\n        return defaultMessage\n    }\n}","inputVariables":["lastState"],"outputVariable":"collectEducationLevelDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b550c069-9f4d-4722-86e8-ba2f37d4b4c0","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"educationLevel","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {  \n        const userInputOptions = {\n            \"GRADUACAO\": [\"1\", \"1 graduacao\", \"graduacao\", \"superior\"],\n            \"POS\": [\"2\", \"2 posgraduacao\", \"posgraduacao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"educationLevel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4ab5f3b7-7eb7-48fe-ae66-3d000a570ce2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectEducationLevel","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectEducationLevel"],"outputVariable":"exceptionErrorCountCollectEducationLevel","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"educationLevel","values":["Input inesperado"]}]}],"$inputSuggestions":["Gradua√ß√£o","P√≥s-Gradua√ß√£o"],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"b0e50305-0750-48f8-828b-20689b71c032","root":false,"$title":"[dados] Coleta n√≠vel de ensino","$position":{"top":"576px","left":"708px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a0f59f8-3de0-4973-a672-4e9615861d53":{"$contentActions":[{"action":{"$id":"7d928a4f-782c-45a3-959f-906f16028599","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"dfa823f9-0fdd-48c3-8714-718b6266bbb4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dfa823f9-0fdd-48c3-8714-718b6266bbb4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9f85ba3b-6b13-44de-aaf9-d540eca4c623","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"979ee40c-d4c8-4dbf-a713-b488cb7164ac","type":"text/plain","content":"Mas n√£o precisa se preocupar. Vou encaminhar a conversa para um dos nosso especialistas.","metadata":{}},"$cardContent":{"document":{"id":"979ee40c-d4c8-4dbf-a713-b488cb7164ac","type":"text/plain","content":"Mas n√£o precisa se preocupar. Vou encaminhar a conversa para um dos nosso especialistas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"760593a5-86ce-4c03-95df-de1edf6055d1","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","typeOfStateId":"state","$connId":"con_143","$id":"44e3f399-5e7e-4797-b5cf-cf3af39dc889","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"8a0f59f8-3de0-4973-a672-4e9615861d53","root":false,"$title":"[geral] Encaminha para atendimento humano","$position":{"top":"194px","left":"1822px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Success"]}],"$cardContent":{"document":{"id":"766b450e-8c37-4516-a1f7-d1b8085de56a","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"c9fa9776-d17d-4977-af47-6c14435633c3","$connId":"con_148","$id":"8872967d-2371-46a0-81a6-b8cd4c09773e"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"c9fa9776-d17d-4977-af47-6c14435633c3","$connId":"con_153","$id":"8d0a571e-066b-4ad7-9198-65cfdb767de2"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"824d2901-4c8d-4e05-93da-4d66bf8e4ea3","$connId":"con_158","$id":"1c2a62e8-2621-4a08-8bcb-d060f898f267"},{"$isDeskOutput":true,"$isDeskDefaultOutput":true,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Error"]}],"stateId":"fallback","$invalid":false}],"$enteringCustomActions":[{"$id":"eb28d4dd-b502-4872-af92-07d22af08456","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ForwardToDesk","conditions":[],"settings":{},"$invalid":false}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","deskStateVersion":"3.0.0","root":false,"$title":"Atendimento humano","$afterStateChangedActions":[{"$id":"9fc5f0ff-bca8-48c1-934c-02c2bea98fa2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"LeavingFromDesk","conditions":[],"settings":{}}],"$position":{"top":"194px","left":"2014px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9fa9776-d17d-4977-af47-6c14435633c3":{"$contentActions":[{"action":{"$id":"09d12801-2cc0-4682-b800-49d8b54011a4","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"7ac58973-8c05-435a-9de1-942db808d4b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7ac58973-8c05-435a-9de1-942db808d4b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"180b6788-5ee9-439b-8eb0-10cd377e3dee","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1f1d29df-5267-44aa-9ba8-86ec7d2d76db","type":"text/plain","content":"Seu atendimento foi encerrado por um do nossos especialistas!","metadata":{}},"$cardContent":{"document":{"id":"1f1d29df-5267-44aa-9ba8-86ec7d2d76db","type":"text/plain","content":"Seu atendimento foi encerrado por um do nossos especialistas!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8d88d9b2-493a-4de3-8e53-dfef9bf3773b","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4510525b-76f1-43de-8bca-f151aa4ddc89","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4510525b-76f1-43de-8bca-f151aa4ddc89","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"bbb3257b-f054-431d-80d8-81fd5df2581e","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"efab0b68-a725-410d-81f2-235bee524d34","type":"text/plain","content":"Caso queira buscar novas recomenda√ß√µes de cursos, √© s√≥ entrar em contato novamente!","metadata":{}},"$cardContent":{"document":{"id":"efab0b68-a725-410d-81f2-235bee524d34","type":"text/plain","content":"Caso queira buscar novas recomenda√ß√µes de cursos, √© s√≥ entrar em contato novamente!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a8916860-0262-4e84-bf6e-760fb4fc34e2","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"169ba2f3-c980-4304-b863-e5b29971874c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"169ba2f3-c980-4304-b863-e5b29971874c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"982ce01c-5910-4837-ba81-f56e42054bbc","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"76d9e7a4-a4c0-4a36-8fe3-8a377bb27c69","type":"text/plain","content":"At√© mais! üëã","metadata":{}},"$cardContent":{"document":{"id":"76d9e7a4-a4c0-4a36-8fe3-8a377bb27c69","type":"text/plain","content":"At√© mais! üëã"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7e2a8935-6340-4957-baca-386c412f63a7","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"c9fa9776-d17d-4977-af47-6c14435633c3","root":false,"$title":"[encerramento] Atendimento humano com sucesso","$position":{"top":"192px","left":"2206px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"824d2901-4c8d-4e05-93da-4d66bf8e4ea3":{"$contentActions":[{"action":{"$id":"3472a77f-c27b-43a6-9666-bcebf32e3e85","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"8747c79a-2d8f-4197-aad7-c161fd2d2bed","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8747c79a-2d8f-4197-aad7-c161fd2d2bed","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dfba5293-13ef-4521-85b8-9ddf49418201","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"088f6aa1-b90b-484d-bf73-b569c8732987","type":"text/plain","content":"Parece que voc√™ j√° n√£o responde h√° algum tempo. Para liberar os nosso especialistas, seu atendimento foi finalizado.","metadata":{}},"$cardContent":{"document":{"id":"088f6aa1-b90b-484d-bf73-b569c8732987","type":"text/plain","content":"Parece que voc√™ j√° n√£o responde h√° algum tempo. Para liberar os nosso especialistas, seu atendimento foi finalizado."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"75195df3-2436-41a5-ba1d-7aea9259ba44","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4e203ada-6cc4-4733-bb24-709b086158ac","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4e203ada-6cc4-4733-bb24-709b086158ac","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d6ccc372-a520-4c73-8513-d6403c182edf","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"02096458-69de-4c24-a63c-5649888ca4cd","type":"text/plain","content":"Mas n√£o se preocupe, caso queira retornar o atendimento, basta me mandar um <b>\"oi\"</b> que recome√ßamos!","metadata":{}},"$cardContent":{"document":{"id":"02096458-69de-4c24-a63c-5649888ca4cd","type":"text/plain","content":"Mas n√£o se preocupe, caso queira retornar o atendimento, basta me mandar um <b>\"oi\"</b> que recome√ßamos!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c09dcbe1-e21d-49a3-9fd5-859ecbe353d4","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"824d2901-4c8d-4e05-93da-4d66bf8e4ea3","root":false,"$title":"[encerramento] Atendimento humano inativado","$position":{"top":"351px","left":"2204px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ad358d7-c06d-47cf-a689-b859e23d482b":{"$contentActions":[{"action":{"$id":"5d61a92a-3f33-4c9d-ad6b-e27a309ac1e2","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"e0ee2472-7244-45c8-a79c-22534bf657d5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e0ee2472-7244-45c8-a79c-22534bf657d5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fa53042d-ba31-429a-ad6f-99ed0ae1ad7e","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"163fd390-80d4-4960-b8d0-b85c68b3b94e","type":"text/plain","content":"Agora, selecione qual a √°rea de atua√ß√£o faz mais sentido:\n{{areasText}}","metadata":{}},"$cardContent":{"document":{"id":"163fd390-80d4-4960-b8d0-b85c68b3b94e","type":"text/plain","content":"Agora, selecione qual a √°rea de atua√ß√£o faz mais sentido:\n{{areasText}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"6d4776d1-53ca-4513-aed2-8fd4c814387b","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0345edf2-67bf-4949-8218-805bd060f734","typeOfStateId":"state","$connId":"con_163","$id":"daccf3de-2791-4ade-b39e-ffc4574ddeda","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"actuationArea"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_168","$id":"bc737e96-793d-4b94-a16b-38391a80e2a2","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["1"],"variable":"exceptionErrorCountCollectArea"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_173","$id":"93fb05f5-9b11-4a9e-981b-ffa71edab478","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"ac56e53d-7fa8-4888-aad0-884a6be9bacb","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"29530a08-c47b-4c6a-b282-3a781f283850","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectArea"},"conditions":[]},{"$id":"d90e210c-af77-44ee-8e0a-00025f2e353e","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get areasText","$invalid":false,"settings":{"function":"run","source":"const run  = (areas) => {\n    return JSON.parse(areas).areasText\n}","inputVariables":["areas"],"outputVariable":"areasText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b3f2e878-cb04-4b21-ab8d-17aa68f038e2","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set actuationArea","$invalid":false,"settings":{"function":"run","source":"const run = (areas, userInput) => {\n    try {\n        const { noDupicatedAreas } = JSON.parse(areas)\n        const optionsMap = buildMappingOptions(noDupicatedAreas)\n        const formattedInput = formatInput(userInput)\n        const option = findOption(formattedInput, optionsMap)\n        return option == \"Input inesperado\" ? option : option.toLowerCase()\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst buildMappingOptions = (areas) => {\n    let areasOptions = {}\n    areas.forEach((currentArea, index) => {\n        const upperArea = currentArea.toUpperCase()\n        areasOptions[upperArea] = generateOptions(currentArea, index)\n    })\n    return areasOptions\n}\n\nconst generateOptions = (text, index) => {\n    const numberSelection = `${index +1}`\n    const formattedText = formatInput(text)\n    const numberTextOption = `${numberSelection} ${formattedText}`\n    return [numberSelection, numberTextOption, formattedText]\n}\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["areas","input.content"],"outputVariable":"actuationArea","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"61039183-f660-4612-a4c4-c10de1cb0303","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectArea","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectArea"],"outputVariable":"exceptionErrorCountCollectArea","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"actuationArea","values":["Input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"0ad358d7-c06d-47cf-a689-b859e23d482b","root":false,"$title":"[dados] Coleta √°rea de atua√ß√£o","$position":{"top":"332px","left":"904px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"17b96932-f787-44f1-a090-545a7110d0db":{"$contentActions":[{"action":{"$id":"7a64c2d8-206c-4a4f-9e79-c9d7fe1a5497","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"c869282a-f15a-4079-b975-d1dc9d4fce4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c869282a-f15a-4079-b975-d1dc9d4fce4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f359076e-4ed4-4cdd-ac5f-84a742e3ae08","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"8ea38461-dacd-4b88-b28a-835bc293db09","type":"text/plain","content":"Aguarde um pouquinho enquanto eu busco os cursos dispon√≠veis. üîç","metadata":{}},"$cardContent":{"document":{"id":"8ea38461-dacd-4b88-b28a-835bc293db09","type":"text/plain","content":"Aguarde um pouquinho enquanto eu busco os cursos dispon√≠veis. üîç"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"486c188f-0c91-4cc2-bbd3-57af2aa2d07f","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ad358d7-c06d-47cf-a689-b859e23d482b","typeOfStateId":"state","$connId":"con_178","$id":"313d921b-b024-47c1-bacb-7a8c4a564105","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"findCoursesStatus"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"0e68a24f-1baa-47b0-bee6-d688ce4a8865","typeOfStateId":"state","$connId":"con_183","$id":"c36cc339-cb44-4ad4-94ca-8bc00d80fe8f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"975875d4-8139-4cae-8a12-7d7a5142be22","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"2442611c-1411-4343-84a1-b8f3c5d6fe4c","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"findCourses"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8cbc4ee6-90d1-4795-bc11-3246b37732a9","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ProcessHttp","$title":"findCourses","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"{{config.baseUrl}}/courses/{{cpfValidation@cpf}}","responseStatusVariable":"findCoursesStatus","responseBodyVariable":"findCoursesResponse"},"conditions":[]},{"$id":"b0d7f122-2cb0-4822-bf4d-73c4ed3bec6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set areas","$invalid":false,"settings":{"function":"run","source":"const run = (coursesResponse, educationLevel) => {\n    try {\n        const { availableCourses: courses } = JSON.parse(coursesResponse);\n        const coursesByEducationLevel = getACoursesByEducationLevel(courses, educationLevel)\n        const areas = getAreas(coursesByEducationLevel, educationLevel)\n        return areas\n    } catch (error) {\n        return \"Error\"\n    }\n}\n\nconst getACoursesByEducationLevel = (courses, educationLevel) => {\n    const lowerEducationLevel = educationLevel.toLowerCase()\n    return courses.filter(currentCourse => currentCourse.nivel == lowerEducationLevel)\n}\n\nconst getAreas = (coursesByEducationLevel) => {\n    const allCoursesAreas = coursesByEducationLevel.map(currentCourse => currentCourse.area)\n    const noDupicatedAreas = [...new Set(allCoursesAreas)]\n    let areasText = \"\"\n    noDupicatedAreas.forEach((area, index) => {\n        areasText += `\\n${index + 1} - ${area}`\n    })\n    return { areasText, noDupicatedAreas}\n}","inputVariables":["findCoursesResponse","educationLevel"],"outputVariable":"areas","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"findCoursesStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0e68a24f-1baa-47b0-bee6-d688ce4a8865","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#7762E3","label":"RequestHttp","id":"blip-tag-c614f341-2284-7d3c-8156-d4be147f5306","canChangeBackground":false}],"id":"17b96932-f787-44f1-a090-545a7110d0db","root":false,"$title":"[api] Consulta cursos","$position":{"top":"194px","left":"909px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a70c2101-574c-49bf-8a11-dda0dc8d1f6c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1c497738-a70a-40d8-a467-1310db4d8577","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1cd7a13d-5d95-45c5-90e8-250635785603","typeOfStateId":"state","$connId":"con_188","$id":"5d6a4690-00d6-4cdb-964e-23d15da08f2a","conditions":[{"source":"input","comparison":"equals","values":["sair","parar","encerrar","encerrar conversa","finalizar","finalizar conversa","cancelar","cancelar conversa","optout","n√£o quero mais falar","nao quero mais falar"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"69b132c2-9a99-435b-8e7d-ec2c4d320827","typeOfStateId":"state","$connId":"con_193","$id":"8788ec41-5d2b-4994-bba5-caed370b5a0e","conditions":[{"source":"context","comparison":"equals","values":["YESORNO"],"variable":"errorType"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"5daba2c8-d27a-4002-aced-33b6ee0d6fc6","typeOfStateId":"state","$connId":"con_198","$id":"da6e9a44-d9c8-45db-8e33-f435eecb7b5d","conditions":[{"source":"context","comparison":"equals","values":["VALIDATION"],"variable":"errorType"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"09f72efb-5afe-49f4-9221-5b14806076c5","typeOfStateId":"state","$connId":"con_203","$id":"c1d48dfa-1dbb-48c5-b953-66249df7e6aa","conditions":[{"source":"context","comparison":"equals","values":["MENUITEM"],"variable":"errorType"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"e18da432-d8de-442b-a360-3f9448213e2a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get errorType","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    try {\n        const errorTypeMapping = {\n            \"YESORNO\": [\"weCanContinue\", \"identifiedPhone\", \"friendRecommendation\", \"recurringPayment\", \"worksInTheArea\", \"askRegistration\"],\n            \"VALIDATION\": [\"collectName\", \"collectPhone\", \"collectCpf\", \"collectCep\"],\n            \"MENUITEM\": [\"collectEducationLevel\", \"collectArea\", \"collectCourse\"]\n        }\n        return findError(stateName, errorTypeMapping)\n    } catch (error) {\n        return 'UNKNOWN'\n    }\n}\n\nconst findError = (stateName, errorTypeMapping) => {\n    const keys = Object.keys(errorTypeMapping);\n    const errorType = keys.find(key =>\n        errorTypeMapping[key].includes(stateName)\n    );\n    return errorType ? errorType : 'UNKNOWN';\n};","inputVariables":["stateName"],"outputVariable":"errorType","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","root":false,"$title":"[erro] Erros de fluxo","$position":{"top":"962px","left":"306px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69b132c2-9a99-435b-8e7d-ec2c4d320827":{"$contentActions":[{"action":{"$id":"d0330903-49c7-4089-8ae1-c9cb9ae1aef9","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"3d9b0464-34a5-4498-b33e-2538ce79e627","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3d9b0464-34a5-4498-b33e-2538ce79e627","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"56c20165-5a2f-40c8-ab93-2188be492bd2","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"dffc61ad-38aa-4481-8126-65fc01db85fb","type":"text/plain","content":"Desculpa, n√£o consegui entender sua resposta. Aqui preciso apenas de um \"sim\"‚Äô ou \"n√£o\".\nVamos tentar novamente.","metadata":{}},"$cardContent":{"document":{"id":"dffc61ad-38aa-4481-8126-65fc01db85fb","type":"text/plain","content":"Desculpa, n√£o consegui entender sua resposta. Aqui preciso apenas de um \"sim\"‚Äô ou \"n√£o\".\nVamos tentar novamente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e9142efe-4353-4490-8dc7-e223b6fa1357","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d69e232f-85ab-43f4-9968-b4dc84e0cf8c","typeOfStateId":"state","$connId":"con_208","$id":"dc801a19-3a1a-48d0-9892-759b38c9140e","conditions":[{"source":"context","comparison":"equals","values":["weCanContinue"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"e86c487b-ccbe-45d7-bfff-d844b32fc9c5","typeOfStateId":"state","$connId":"con_213","$id":"cb370e55-3f5c-4fa0-b08e-0442da912b34","conditions":[{"source":"context","comparison":"equals","values":["identifiedPhone"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"90e9e590-f52e-4b25-bdac-20d99803d51a","typeOfStateId":"state","$connId":"con_218","$id":"735a16fa-aa3c-410d-b229-dc343ea3b23f","conditions":[{"source":"context","comparison":"equals","values":["friendRecommendation"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"fd57e4dc-9b22-4726-a406-a0c03d218e64","typeOfStateId":"state","$connId":"con_223","$id":"6c265fbf-7fad-4613-872a-26141d11fb26","conditions":[{"source":"context","comparison":"equals","values":["recurringPayment"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"e4f494d6-4e3f-4dbe-a801-6f695a5aa472","typeOfStateId":"state","$connId":"con_228","$id":"6fbe2a7f-2c69-4aea-b652-abf927ea2f69","conditions":[{"source":"context","comparison":"equals","values":["worksInTheArea"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"36352ac4-85a2-428a-b4ea-6f5307c0cafc","typeOfStateId":"state","$connId":"con_233","$id":"52663a0a-fae7-4b0b-b96a-d1e6f774ba84","conditions":[{"source":"context","comparison":"equals","values":["askRegistration"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"69b132c2-9a99-435b-8e7d-ec2c4d320827","root":false,"$title":"[erro] Menu sim ou n√£o","$position":{"top":"1096px","left":"302px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5daba2c8-d27a-4002-aced-33b6ee0d6fc6":{"$contentActions":[{"action":{"$id":"547535e1-abe1-455e-a9d6-2456c8f0faf6","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af61f3b3-ac68-4cd4-8262-b466ee413b6a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"af61f3b3-ac68-4cd4-8262-b466ee413b6a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5b4a6e00-0f22-4653-ad2f-faffb7355179","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"976bb5c2-43ef-4bbd-969e-f6c42dd1e231","type":"text/plain","content":"{{validationErrorDynamicMessage}}","metadata":{}},"$cardContent":{"document":{"id":"976bb5c2-43ef-4bbd-969e-f6c42dd1e231","type":"text/plain","content":"{{validationErrorDynamicMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a077cc99-2946-4687-a9d9-1163b63ffd9e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f1e93db1-9f24-4a54-ac14-2d390a4164ab","typeOfStateId":"state","$connId":"con_238","$id":"29261cfa-3506-45a1-939e-7dd13a7e79bc","conditions":[{"source":"context","comparison":"equals","values":["collectName"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"df93d1ad-ff72-4299-b739-9a9a1c74fc01","typeOfStateId":"state","$connId":"con_243","$id":"9f460c4d-ec29-44ad-aed9-458cb838d9bc","conditions":[{"source":"context","comparison":"equals","values":["collectPhone"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"8975008d-73f2-4187-a368-1a79ce60ea47","typeOfStateId":"state","$connId":"con_248","$id":"57a7babc-496b-4598-b16b-bfae866b5cbd","conditions":[{"source":"context","comparison":"equals","values":["collectCpf"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"0dbbd906-3c0e-4adb-9795-071944bf5e7a","typeOfStateId":"state","$connId":"con_253","$id":"3c8a1da4-cc1d-4875-a5c4-2656f84cdbe1","conditions":[{"source":"context","comparison":"equals","values":["collectCep"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_258","$id":"98618f99-96f4-4aec-bf21-94ccdea79acf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"8e214436-b90d-43c3-83c5-b19d89cfe0dd","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set validationErrorDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    const defaultMessage = \"Parece que voc√™ est√° com problema para fornecer seus dados.\\nVamos tentar novamente!\"\n    try {\n        const messageStateMapping = {\n            \"collectName\": \"Parece que voc√™ est√° tendo problemas em fornecer seu nome completo.\\nVamos tentar novamente!\",\n            \"collectPhone\": \"Parece que voc√™ est√° tendo problemas em fornecer seu telefone.\\n\\nUm telefone completo √© composto por <b>DDI + DDD + N√öMERO DE TELEFONE COM O NOVO D√çGITO</b>, assim como o exemplo: 5553981371243.\\n\\nVamos tentar novamente!\",\n            \"collectCpf\": \"O valor informado n√£o me parece um CPF v√°lido.\\nVamos tentar novamente!\",\n            \"collectCep\": \"Parece que voc√™ n√£o me informou um CEP com um formato v√°lido.\\nLembrando que um CEP √© composto de oito d√≠gitos seguindo padr√£o <b>00000-000</b>\\nVamos tentar novamente!\"\n        }\n        return stateName && messageStateMapping[stateName] ? messageStateMapping[stateName] : defaultMessage\n    } catch (error) {\n        return defaultMessage\n    }\n}","inputVariables":["stateName"],"outputVariable":"validationErrorDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"5daba2c8-d27a-4002-aced-33b6ee0d6fc6","root":false,"$title":"[erro] Erro de valida√ß√£o","$position":{"top":"1316px","left":"304px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"23d1954f-134e-47b0-ab6f-42b8e356859d":{"$contentActions":[{"action":{"$id":"70fc0019-5bd8-40f1-9530-52f098b71846","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"2db45f85-3d16-4785-9b57-774c59761a01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2db45f85-3d16-4785-9b57-774c59761a01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f628ffba-7449-48cb-83ee-029695298edc","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"8fb3900b-b633-41bb-9e78-6441697cb223","type":"text/plain","content":"Humm, parece que voc√™ ainda est√° tendo problemas ao informar uma resposta v√°lida.","metadata":{}},"$cardContent":{"document":{"id":"8fb3900b-b633-41bb-9e78-6441697cb223","type":"text/plain","content":"Humm, parece que voc√™ ainda est√° tendo problemas ao informar uma resposta v√°lida."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2ee75872-19f5-4ac1-ab8d-48a8adb4e5b7","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_263","$id":"055017f0-c961-4701-b1ec-07440269ddda","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"23d1954f-134e-47b0-ab6f-42b8e356859d","root":false,"$title":"[erro] Tentativas excedidas","$position":{"top":"1445px","left":"302px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0dbbd906-3c0e-4adb-9795-071944bf5e7a":{"$contentActions":[{"action":{"$id":"15d82c09-cf7f-4a28-8c74-5c3b1743261d","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"00f5a013-0611-4ba2-bdad-1f641448b7b0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00f5a013-0611-4ba2-bdad-1f641448b7b0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5f80aec7-1556-4f06-893f-887b7cb50915","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"971f9d0a-2723-4e22-b254-ad796efe1cd1","type":"text/plain","content":"{{collectCepDynamicMessage}}","metadata":{}},"$cardContent":{"document":{"id":"971f9d0a-2723-4e22-b254-ad796efe1cd1","type":"text/plain","content":"{{collectCepDynamicMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e4a06317-f173-4620-802f-f187f820e23e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6d0f86cc-3db0-486f-800d-de534edb339c","typeOfStateId":"state","$connId":"con_268","$id":"8cb63227-e50f-4e64-aa93-029e443447a0","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"cepValidation@isValid"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_273","$id":"fbe5df53-f188-4f15-b78a-ce272db9b93e","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"cepValidation@isValid"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountCollectCep","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_278","$id":"4f360180-ca2b-4757-9d41-b99f00402a15","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"0539678c-4108-4a7e-8537-5b258e41edc4","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"b4d7aff3-f677-4389-b147-1a2382e92637","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectCep"},"conditions":[]},{"$id":"aa715b4c-c5d2-489b-9eb0-94b3876784ed","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set collectCepDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (stateName) => {\n    const defaultMessage = \"Perfeito! Agora, me informe qual √© o seu <b>CEP</b>:\"\n    try {\n        return stateName && stateName === \"collectCep\" ? \"Por favor, me informe seu <b>CEP</b>:\" : defaultMessage\n    } catch (error) {\n        return defaultMessage\n    }\n}","inputVariables":["lastState"],"outputVariable":"collectCepDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4fcb4dfc-ef70-4676-8b84-ec01df1e6f2a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set cepValidation","$invalid":false,"settings":{"function":"run","source":"const run = (cepInput) => {\n    const defaultValidation = { isValid: false, cep: null }\n    try {\n        const cep = cepInput.replace(/\\D+/g, '')\n        if (cep.length != 8) return defaultValidation\n        return { isValid: true, cep }\n    } catch (error) {\n        return defaultValidation\n    }\n}","inputVariables":["input.content"],"outputVariable":"cepValidation","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fee70325-6c63-4f48-acd9-df7616f0bfe7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectCep","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectCep"],"outputVariable":"exceptionErrorCountCollectCep","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"cepValidation@isValid","values":["false"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"0dbbd906-3c0e-4adb-9795-071944bf5e7a","root":false,"$title":"[dados] Coleta CEP","$position":{"top":"328px","left":"712px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e68a24f-1baa-47b0-bee6-d688ce4a8865":{"$contentActions":[{"action":{"$id":"6652bce0-1606-45dd-90a8-79a7afbffd65","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"c0abd030-3316-4f06-ac46-18aaa1512473","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c0abd030-3316-4f06-ac46-18aaa1512473","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5ca572eb-fe5d-41ff-9c7f-9df28b1b51f0","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"8ae2ed00-79be-4b85-8314-92a7e737af07","type":"text/plain","content":"Hmm, estou tendo problemas para consultar nossos sistemas.","metadata":{}},"$cardContent":{"document":{"id":"8ae2ed00-79be-4b85-8314-92a7e737af07","type":"text/plain","content":"Hmm, estou tendo problemas para consultar nossos sistemas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"62fee3e4-3798-4bcc-95dc-b35aab07158b","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_283","$id":"7a2edbde-b96b-4008-9f02-7d986e8f2880","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"0e68a24f-1baa-47b0-bee6-d688ce4a8865","root":false,"$title":"[erro] Falha na consulta de API","$position":{"top":"1204px","left":"304px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a4494a0f-a8f0-4a79-ae7e-23964c3bdc33":{"$contentActions":[{"action":{"$id":"f3807b8d-301c-4204-9aba-1c7887d96226","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"2717a498-818f-4f65-ac72-bc438de198c9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2717a498-818f-4f65-ac72-bc438de198c9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d96f1090-a205-4aa1-8c8b-9d9e0ecf540b","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"282d31a1-8160-4b30-8161-5eeef7a0b57e","type":"text/plain","content":"Infelizmente n√£o consegui encontrar as informa√ß√µes do seu endere√ßo  üòî","metadata":{}},"$cardContent":{"document":{"id":"282d31a1-8160-4b30-8161-5eeef7a0b57e","type":"text/plain","content":"Infelizmente n√£o consegui encontrar as informa√ß√µes do seu endere√ßo  üòî"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"58f5841d-37d3-4b74-a841-873dff089c11","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_288","$id":"dfb5b5f0-15e3-488c-aa52-708aec5cd87c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"a4494a0f-a8f0-4a79-ae7e-23964c3bdc33","root":false,"$title":"[erro] Cep  inv√°lido ou n√£o encontrado","$position":{"top":"1556px","left":"302px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"09f72efb-5afe-49f4-9221-5b14806076c5":{"$contentActions":[{"action":{"$id":"a20f5c9e-7dc0-4d3c-b63b-f1dddcdb2678","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4027e6d9-4fdc-4c3d-8178-83a876dac49b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4027e6d9-4fdc-4c3d-8178-83a876dac49b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2145e763-24ce-47b0-997c-f7a0c55ee8f0","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"e85a1042-6e14-46ab-81a9-eabe5ce10199","type":"text/plain","content":"N√£o entendi a op√ß√£o selecionada, vamos tentar novamente!","metadata":{}},"$cardContent":{"document":{"id":"e85a1042-6e14-46ab-81a9-eabe5ce10199","type":"text/plain","content":"N√£o entendi a op√ß√£o selecionada, vamos tentar novamente!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"673bd01c-1360-4198-a158-78baa82b3e6e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b0e50305-0750-48f8-828b-20689b71c032","typeOfStateId":"state","$connId":"con_293","$id":"1c4e467b-507c-4d83-b887-7136cb30354b","conditions":[{"source":"context","comparison":"equals","values":["collectEducationLevel"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"0ad358d7-c06d-47cf-a689-b859e23d482b","typeOfStateId":"state","$connId":"con_298","$id":"6b5d45ff-06d2-428e-8d92-a49d95341d9b","conditions":[{"source":"context","comparison":"equals","values":["collectArea"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"0345edf2-67bf-4949-8218-805bd060f734","typeOfStateId":"state","$connId":"con_303","$id":"23b6f7d9-0116-4cc1-b1d1-b0388950a7a6","conditions":[{"source":"context","comparison":"equals","values":["collectCourse"],"variable":"stateName"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"09f72efb-5afe-49f4-9221-5b14806076c5","root":false,"$title":"[erro] Item de menu","$position":{"top":"1667px","left":"302px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0345edf2-67bf-4949-8218-805bd060f734":{"$contentActions":[{"action":{"$id":"79a61cc3-8a93-47c9-ab7c-9e57bc4d6c80","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1337c04a-7cb8-46d2-b498-2fe55943796e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1337c04a-7cb8-46d2-b498-2fe55943796e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9598fd98-6435-4c1a-9aa3-fad73b7870fb","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"a2bae201-2f80-457f-bd26-f580ee9a93a8","type":"text/plain","content":"Encontrei os seguintes cursos com as informa√ß√µes fornecidas. Qual deles faz mais sentido para voc√™?\n\n{{coursesText}}","metadata":{}},"$cardContent":{"document":{"id":"a2bae201-2f80-457f-bd26-f580ee9a93a8","type":"text/plain","content":"Encontrei os seguintes cursos com as informa√ß√µes fornecidas. Qual deles faz mais sentido para voc√™?\n\n{{coursesText}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"91eddcc4-28b0-48ce-9edd-6421e97369b3","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f99a8cfd-dce7-4360-93c3-fdc744a5f9b8","typeOfStateId":"state","$connId":"con_308","$id":"cea5f128-8007-432e-878a-e972ad950d02","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"selectedCourse"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_313","$id":"2178942b-1380-4c25-b75a-a86395e3e932","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["1"],"variable":"exceptionErrorCountCollectCourse"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","typeOfStateId":"state","$connId":"con_318","$id":"07c9c6d0-3e92-4dfe-a52d-fe1265438d4f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"4015240c-5224-4ed6-bd24-5da77e58e80a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e4accb7f-5561-4567-80db-bcf36297c7d4","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"collectCourse"},"conditions":[]},{"$id":"c8c31951-4bb2-473c-9de0-a9f176dbda51","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get courses","$invalid":false,"settings":{"function":"run","source":"const run = (coursesResponse, educationLevel, actuationArea) => {\n    try {\n        const { availableCourses: courses } = JSON.parse(coursesResponse);\n        const coursesByEducationLevelAndArea = getCoursesByEducationLevelAndArea(courses, educationLevel, actuationArea)\n        const availableCourses = getCourses(coursesByEducationLevelAndArea)\n        return availableCourses\n    } catch (error) {\n        return \"Error\"\n    }\n}\n\nconst getCoursesByEducationLevelAndArea = (courses, educationLevel, actuationArea) => {\n    const lowerEducationLevel = educationLevel.toLowerCase()\n    const lowerArea = actuationArea.toLowerCase()\n    return courses.filter(currentCourse => currentCourse.nivel == lowerEducationLevel && currentCourse.area.toLowerCase() == lowerArea)\n}\n\nconst getCourses = (coursesByEducationLevelAndArea) => {\n    const courses = coursesByEducationLevelAndArea.map(currentCourse => currentCourse.nome)\n    let coursesText = \"\"\n    courses.forEach((name, index) => {\n        coursesText += `\\n${index + 1} - ${name}`\n    })\n    return { coursesText, courses}\n}","inputVariables":["findCoursesResponse","educationLevel","actuationArea"],"outputVariable":"courses","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5883cd12-50ce-45be-a6de-416f98dd6e7f","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get coursesText","$invalid":false,"settings":{"function":"run","source":"const run  = (courses) => {\n    return JSON.parse(courses).coursesText\n}","inputVariables":["courses"],"outputVariable":"coursesText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"85922d1a-d85d-4a5e-bb6e-387cfaaa59cf","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set selectedCourse","$invalid":false,"settings":{"function":"run","source":"const run = (coursesObject, userInput) => {\n    try {\n        const { courses } = JSON.parse(coursesObject)\n        const optionsMap = buildMappingOptions(courses)\n        const formattedInput = formatInput(userInput)\n        const option = findOption(formattedInput, optionsMap)\n        return option\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst buildMappingOptions = (courses) => {\n    let coursesOption = {}\n    courses.forEach((currentCourse, index) => {\n        coursesOption[currentCourse] = generateOptions(currentCourse, index)\n    })\n    return coursesOption\n}\n\nconst generateOptions = (text, index) => {\n    const numberSelection = `${index + 1}`\n    const formattedText = formatInput(text)\n    const numberTextOption = `${numberSelection} ${formattedText}`\n    return [numberSelection, numberTextOption, formattedText]\n}\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["courses","input.content"],"outputVariable":"selectedCourse","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0619d3a3-1bba-4f88-a2b7-565fbfd6c6e7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountCollectCourse","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountCollectCourse"],"outputVariable":"exceptionErrorCountCollectCourse","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"actuationArea","values":["Input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23d1954f-134e-47b0-ab6f-42b8e356859d","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"0345edf2-67bf-4949-8218-805bd060f734","root":false,"$title":"[cursos] Coleta curso","$position":{"top":"469px","left":"906px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f99a8cfd-dce7-4360-93c3-fdc744a5f9b8":{"$contentActions":[{"action":{"$id":"faab71a2-dbed-4cc9-a160-d23d19f2c43b","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"87cc4614-9b7e-4b20-82f0-5c85e55d2b9a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"87cc4614-9b7e-4b20-82f0-5c85e55d2b9a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c04a04ca-f01b-48c1-84d1-7e0466f50231","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"d0301067-9fee-4b61-bde1-6e56dd120120","type":"text/plain","content":"√ìtima escolha! ü§©\nO curso {{selectedCourse}} √© realmente incr√≠vel.","metadata":{}},"$cardContent":{"document":{"id":"d0301067-9fee-4b61-bde1-6e56dd120120","type":"text/plain","content":"√ìtima escolha! ü§©\nO curso {{selectedCourse}} √© realmente incr√≠vel."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"798bd69e-68ce-4333-aef7-2b93c7c67dcf","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"19f6d21a-d18c-4702-8df0-5e9309b2cc66","typeOfStateId":"state","$connId":"con_323","$id":"58494445-517e-4fdb-95b8-060dd99e4326","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19f6d21a-d18c-4702-8df0-5e9309b2cc66","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"f99a8cfd-dce7-4360-93c3-fdc744a5f9b8","root":false,"$title":"[carrinho] √ìtima ecolha","$position":{"top":"606px","left":"904px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"19f6d21a-d18c-4702-8df0-5e9309b2cc66":{"$contentActions":[{"action":{"$id":"fb96b5cd-a6ce-43ab-9772-67966d9aacdc","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"b727fb2c-b488-4dc9-b152-557d4a11255d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b727fb2c-b488-4dc9-b152-557d4a11255d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c03394eb-fba8-40d1-aa23-b1f58b96f260","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"d3ee6d42-41c1-4cdc-b4de-b430a8ee41ab","type":"text/plain","content":"Antes de te dar o pre√ßo do curso escolhido, vou precisar fazer algumas perguntinhas.","metadata":{}},"$cardContent":{"document":{"id":"d3ee6d42-41c1-4cdc-b4de-b430a8ee41ab","type":"text/plain","content":"Antes de te dar o pre√ßo do curso escolhido, vou precisar fazer algumas perguntinhas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5978736d-23d7-497f-951c-679579e9371f","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90e9e590-f52e-4b25-bdac-20d99803d51a","typeOfStateId":"state","$connId":"con_328","$id":"d51d221a-8188-4ac8-9666-0bead69408a3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"90e9e590-f52e-4b25-bdac-20d99803d51a","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"19f6d21a-d18c-4702-8df0-5e9309b2cc66","root":false,"$title":"[carirnho] Informa sobre perguntas","$position":{"top":"723px","left":"901px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"90e9e590-f52e-4b25-bdac-20d99803d51a":{"$contentActions":[{"action":{"$id":"c68cf2d5-d86d-499f-b3ad-857a75aa9806","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0794ac8-28d0-4bc1-a508-adbd16ed4426","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Algum amigo te indicou a <b>+A Educa√ß√£o</b>?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Algum amigo te indicou a <b>+A Educa√ß√£o</b>?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8eeac3e6-b809-40f3-93d7-3667674fc517","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fd57e4dc-9b22-4726-a406-a0c03d218e64","typeOfStateId":"state","$connId":"con_333","$id":"bb9d88da-b1ec-4622-9a58-6892b1ea0499","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_338","$id":"f003f47d-36e6-4266-b2ad-cd55f9848cbf","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountFriendRecommendation","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"3ae0c56d-8176-40d3-9324-dcbd952d79b3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e6aa16ad-b6eb-4287-a96a-fa963d1fdf6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"friendRecommendation"},"conditions":[]}],"$leavingCustomActions":[{"$id":"10d5f27a-b57c-49f2-bee4-b5b5c2658cb3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751c1853-a282-4c2f-baaa-c8e05963fae1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountFriendRecommendation","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountFriendRecommendation"],"outputVariable":"exceptionErrorCountFriendRecommendation","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]},{"$id":"51b21cd8-672d-40a5-ba9c-aff04fbf0d6d","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set friendRecommendation","$invalid":false,"settings":{"variable":"friendRecommendation","value":"true"},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["SIM"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"90e9e590-f52e-4b25-bdac-20d99803d51a","root":false,"$title":"[descontos] Pergunta indica√ß√£o de amigo","$position":{"top":"195px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fd57e4dc-9b22-4726-a406-a0c03d218e64":{"$contentActions":[{"action":{"$id":"c68cf2d5-d86d-499f-b3ad-857a75aa9806","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0794ac8-28d0-4bc1-a508-adbd16ed4426","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Deseja manter o <b>pagamento recorrente</b> no seu <b>cart√£o de cr√©dito</b>? üí≥","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Deseja manter o <b>pagamento recorrente</b> no seu <b>cart√£o de cr√©dito</b>? üí≥","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8eeac3e6-b809-40f3-93d7-3667674fc517","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4f494d6-4e3f-4dbe-a801-6f695a5aa472","typeOfStateId":"state","$connId":"con_343","$id":"bb9d88da-b1ec-4622-9a58-6892b1ea0499","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"equals","variable":"educationLevel","values":["POS"]}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"58fb9de5-f5f8-4244-9516-e544ae8464ef","typeOfStateId":"state","$connId":"con_348","$id":"8c8e413d-9601-4646-a6a4-29c987e4a6ac","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_353","$id":"f003f47d-36e6-4266-b2ad-cd55f9848cbf","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountRecurringPayment","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"3ae0c56d-8176-40d3-9324-dcbd952d79b3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e6aa16ad-b6eb-4287-a96a-fa963d1fdf6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"recurringPayment"},"conditions":[]}],"$leavingCustomActions":[{"$id":"10d5f27a-b57c-49f2-bee4-b5b5c2658cb3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751c1853-a282-4c2f-baaa-c8e05963fae1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountRecurringPayment","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountRecurringPayment"],"outputVariable":"exceptionErrorCountRecurringPayment","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]},{"$id":"51b21cd8-672d-40a5-ba9c-aff04fbf0d6d","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set recurringPayment","$invalid":false,"settings":{"variable":"recurringPayment","value":"true"},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["SIM"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"fd57e4dc-9b22-4726-a406-a0c03d218e64","root":false,"$title":"[descontos] Pergunta pagamento recorrente","$position":{"top":"350px","left":"1098px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e4f494d6-4e3f-4dbe-a801-6f695a5aa472":{"$contentActions":[{"action":{"$id":"c68cf2d5-d86d-499f-b3ad-857a75aa9806","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0794ac8-28d0-4bc1-a508-adbd16ed4426","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Me conta, voc√™ <b>j√° trabalha na √°rea</b> do curso selecionado?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Me conta, voc√™ <b>j√° trabalha na √°rea</b> do curso selecionado?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8eeac3e6-b809-40f3-93d7-3667674fc517","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"58fb9de5-f5f8-4244-9516-e544ae8464ef","typeOfStateId":"state","$connId":"con_358","$id":"bb9d88da-b1ec-4622-9a58-6892b1ea0499","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_363","$id":"f003f47d-36e6-4266-b2ad-cd55f9848cbf","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountWorksInTheArea","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"3ae0c56d-8176-40d3-9324-dcbd952d79b3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e6aa16ad-b6eb-4287-a96a-fa963d1fdf6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"worksInTheArea"},"conditions":[]}],"$leavingCustomActions":[{"$id":"10d5f27a-b57c-49f2-bee4-b5b5c2658cb3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751c1853-a282-4c2f-baaa-c8e05963fae1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountWorksInTheArea","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountWorksInTheArea"],"outputVariable":"exceptionErrorCountWorksInTheArea","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]},{"$id":"51b21cd8-672d-40a5-ba9c-aff04fbf0d6d","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set worksInTheArea","$invalid":false,"settings":{"variable":"worksInTheArea","value":"true"},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["SIM"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"e4f494d6-4e3f-4dbe-a801-6f695a5aa472","root":false,"$title":"[descontos] Pergunta j√° trabalha na √°rea","$position":{"top":"532px","left":"1099px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"58fb9de5-f5f8-4244-9516-e544ae8464ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f87f4680-9206-4056-adb9-39eaf7274b69","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1491"}],"$conditionOutputs":[{"stateId":"afb94c5d-43fe-4a44-9bb8-96908e6d6eb5","typeOfStateId":"state","$connId":"con_368","$id":"6bf7ad1f-69bb-4115-9522-835f0560fa0e","conditions":[{"source":"context","comparison":"notEquals","values":["Error"],"variable":"cartMessage","$$hashKey":"object:1539"}],"$isBuilderDefaultOutput":true,"$invalid":false,"$$hashKey":"object:1523"},{"stateId":"13b6b93d-3857-4f73-b442-f9ccb11878b9","typeOfStateId":"state","$connId":"con_373","$id":"b29a152f-298d-4fb7-b9c3-ef9bed335f20","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1557"}],"$isBuilderDefaultOutput":true,"$invalid":false,"$$hashKey":"object:1524"}],"$enteringCustomActions":[{"$id":"529067b4-265d-4181-bcfc-ee3590431cc3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"set cartMessage","$invalid":false,"settings":{"function":"run","source":"const run = (selectedCourse, findCoursesResponse, friendRecommendation, recurringPayment, worksInTheArea) => {\n    try {\n        const { availableCourses: courses } = JSON.parse(findCoursesResponse)\n        const { preco_base: price, enrollmentClosingDate } = getCourseInfosByName(courses, selectedCourse)\n        const isClosingDate = checkIfIsClosingDate(enrollmentClosingDate)\n        const discount = calculateDiscountPercentage(isClosingDate, friendRecommendation, recurringPayment, worksInTheArea)\n        const discountPrice = calculateDiscount(price, discount)\n        return buildCart(selectedCourse, price, discount, discountPrice)\n    } catch (error) {\n        return \"Error\"\n    }\n}\n\nconst buildCart = (selectedCourse, price, discount, discountPrice) => {\n    const formattedPrice = formatPrice(price)\n    const congratulationsMessage = `üéâ Parab√©ns por escolher o curso: <b>${selectedCourse.toUpperCase()}</b>.`\n    const discountMessage = `Mas consegui um desconto bem bacana pra voc√™ de <b>${discount}%!</b> ü§ë`\n    const normalPriceMessage = discount > 0 ? `Normalmente o valor da mensalidade √© ${formattedPrice}. ${discountMessage}` : `O valor final da fica fica ${formattedPrice}.`\n    const finalValueMessage = discount > 0 ? `Pre√ßo normal: ${formattedPrice}.\\nPre√ßo com desconto aplicado: ${formatPrice(discountPrice)}` : \"\"\n    return `${congratulationsMessage}\\n\\n${normalPriceMessage}\\n\\n${finalValueMessage}`.trim()\n}\n\nfunction formatPrice(value) {\n    const fixed = value.toFixed(2);\n    let [integerPart, decimalPart] = fixed.split(\".\");\n    integerPart = integerPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\n    return `R$ ${integerPart},${decimalPart}`;\n}\n\nconst calculateDiscount = (price, discount) => {\n    return price - (price * (discount / 100))\n}\n\n\nconst getCourseInfosByName = (courses, name) => {\n    return courses.find(course => course.nome == name)\n}\n\nconst calculateDiscountPercentage = (isClosingDate, friendRecommendation, recurringPayment, worksInTheArea) => {\n    let totalDiscount = 0\n    if (parseFloat(friendRecommendation)) totalDiscount += 5\n    if (parseFloat(recurringPayment)) totalDiscount += 5\n    if (parseFloat(worksInTheArea)) totalDiscount += 10\n    if (isClosingDate) totalDiscount += 7\n    return totalDiscount <= 20 ? totalDiscount : 20\n}\n\n\nconst checkIfIsClosingDate = (enrollmentClosingDate) => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const [day, month] = enrollmentClosingDate.split(\"/\").map(Number);\n    const enrollmentDate = new Date(today.getFullYear(), month - 1, day);\n    enrollmentDate.setHours(0, 0, 0, 0);\n    const diff = enrollmentDate.getTime() - today.getTime();\n    const sevenDaysMs = 7 * 24 * 60 * 60 * 1000;\n    return diff >= 0 && diff <= sevenDaysMs;\n}","inputVariables":["selectedCourse","findCoursesResponse","friendRecommendation","recurringPayment","worksInTheArea"],"outputVariable":"cartMessage","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"353fbcda-4fcf-43f5-8d04-cee4bcc7ee7c","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get address","$invalid":false,"settings":{"function":"run","source":"const run = (findCepResponse) => {\n    const defaultAddress = {\n        \"uf\": null,\n        \"city\": null,\n        \"neighborhood\": null,\n        \"street\": null\n    }\n    try {\n        const {uf, localidade: city, bairro: neighborhood, logradouro: street } = JSON.parse(findCepResponse)\n        return {uf, city, neighborhood, street}\n    } catch (error) {\n        return defaultAddress\n    }\n}","inputVariables":["findCepResponse"],"outputVariable":"address","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aad89415-1eed-4714-8d49-1a88faa2b138","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get courseInfos","$invalid":false,"settings":{"function":"run","source":"const run = (findCoursesResponse, selectedCourse) => {\n    try {\n        const { availableCourses: courses } = JSON.parse(findCoursesResponse);\n        return courses.find(course => course.nome == selectedCourse)\n    } catch (error) {\n        return \"Error\"\n    }\n}","inputVariables":["findCoursesResponse","selectedCourse"],"outputVariable":"courseInfos","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"13b6b93d-3857-4f73-b442-f9ccb11878b9","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false},{"background":"#ffcbdb","label":"MergeContact","id":"blip-tag-828cf8c8-9be5-bc5d-383c-98f1efd2bd0d","canChangeBackground":false}],"id":"58fb9de5-f5f8-4244-9516-e544ae8464ef","root":false,"$title":"[carrinho] Atualiza informa√ß√µes","$position":{"top":"694px","left":"1096px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"afb94c5d-43fe-4a44-9bb8-96908e6d6eb5":{"$contentActions":[{"action":{"$id":"9b2389dd-37b5-499c-bc90-80055e362c3e","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"f9bf659f-d4c6-4b06-a0e0-d1c5fb9168b9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f9bf659f-d4c6-4b06-a0e0-d1c5fb9168b9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2058"},{"action":{"$id":"5bb79768-0830-4326-a740-251e83b1ed24","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"e42f9e2e-ceb5-46c7-8833-db86c36605b9","type":"text/plain","content":"{{cartMessage}}","metadata":{}},"$cardContent":{"document":{"id":"e42f9e2e-ceb5-46c7-8833-db86c36605b9","type":"text/plain","content":"{{cartMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2059"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"169a6783-7f20-4fca-a79d-9a6115024592","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2060"}],"$conditionOutputs":[{"stateId":"36352ac4-85a2-428a-b4ea-6f5307c0cafc","typeOfStateId":"state","$connId":"con_378","$id":"449648d5-eaa9-460f-a271-7536491f1874","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2086"}],"$isBuilderDefaultOutput":true,"$invalid":false,"$$hashKey":"object:2068"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"36352ac4-85a2-428a-b4ea-6f5307c0cafc","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false}],"id":"afb94c5d-43fe-4a44-9bb8-96908e6d6eb5","root":false,"$title":"[carrinho] Exibe carrinho","$position":{"top":"198px","left":"1284px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"13b6b93d-3857-4f73-b442-f9ccb11878b9":{"$contentActions":[{"action":{"$id":"dfc77280-40ad-415c-8b92-e6e51209b620","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"7e88539f-6805-4c0d-b1e8-50e43e8cdf65","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7e88539f-6805-4c0d-b1e8-50e43e8cdf65","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8631d4f4-7640-4239-a4dd-55703d197dc6","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"735b956e-0c64-4e1c-a6a7-daf2228393dd","type":"text/plain","content":"Ops, estou tendo problemas pra terminar a simula√ß√£o.","metadata":{}},"$cardContent":{"document":{"id":"735b956e-0c64-4e1c-a6a7-daf2228393dd","type":"text/plain","content":"Ops, estou tendo problemas pra terminar a simula√ß√£o."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"773227dc-05dc-438f-82d3-a7ed7545c95c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","typeOfStateId":"state","$connId":"con_383","$id":"bedf703f-4cd6-458b-93cf-1fc2884a5e32","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8a0f59f8-3de0-4973-a672-4e9615861d53","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"13b6b93d-3857-4f73-b442-f9ccb11878b9","root":false,"$title":"[erro] Erro ao montar carrinho","$position":{"top":"1782px","left":"301px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36352ac4-85a2-428a-b4ea-6f5307c0cafc":{"$contentActions":[{"action":{"$id":"c68cf2d5-d86d-499f-b3ad-857a75aa9806","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d1ee14a-de83-45e0-8f07-176a28db7c17","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0794ac8-28d0-4bc1-a508-adbd16ed4426","$typeOfContent":"select-immediate","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Agora que j√° encontrei o melhor curso para voc√™, gostaria de realizar sua inscri√ß√£o?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false},"metadata":{}},"$cardContent":{"document":{"id":"af1e5f60-f505-40b7-9abe-b426f951dc77","type":"application/vnd.lime.select+json","content":{"text":"Agora que j√° encontrei o melhor curso para voc√™, gostaria de realizar sua inscri√ß√£o?","scope":"immediate","options":[{"text":"Sim","previewText":"Sim","value":null,"index":0,"type":null},{"text":"N√£o","previewText":"N√£o","value":null,"index":1,"type":null}],"quikReply":false}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8eeac3e6-b809-40f3-93d7-3667674fc517","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c22b56c8-fead-4b1c-9ae5-1fd9c38d39e1","typeOfStateId":"state","$connId":"con_388","$id":"bb9d88da-b1ec-4622-9a58-6892b1ea0499","conditions":[{"source":"context","comparison":"equals","values":["SIM"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"fa929d8e-f664-43f9-a1f4-f2a5bf822015","typeOfStateId":"state","$connId":"con_393","$id":"6e7325b5-8d85-419f-9893-0597929cfe05","conditions":[{"source":"context","comparison":"equals","values":["N√ÉO"],"variable":"userInput"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","typeOfStateId":"state","$connId":"con_398","$id":"f003f47d-36e6-4266-b2ad-cd55f9848cbf","conditions":[{"source":"context","comparison":"equals","values":["Input inesperado"],"variable":"userInput"},{"source":"context","comparison":"lessThanOrEquals","variable":"exceptionErrorCountAskRegistration","values":["1"]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"3ae0c56d-8176-40d3-9324-dcbd952d79b3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set lastState","$invalid":false,"settings":{"variable":"lastState","value":"{{stateName}}"},"conditions":[]},{"$id":"e6aa16ad-b6eb-4287-a96a-fa963d1fdf6a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set stateName","$invalid":false,"settings":{"variable":"stateName","value":"askRegistration"},"conditions":[]}],"$leavingCustomActions":[{"$id":"10d5f27a-b57c-49f2-bee4-b5b5c2658cb3","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n    try {\n        const userInputOptions = {\n            \"SIM\": [\"1\", \"1 sim\", \"sim\"],\n            \"NAO\": [\"2\", \"2 nao\", \"nao\"]\n        }\n        const formattedInput = formatInput(userInput)\n        return findOption(formattedInput, userInputOptions)\n    } catch (error) {\n        return \"Input inesperado\"\n    }\n}\n\nconst findOption = (formattedInput, userInputOptions) => {\n    const keys = Object.keys(userInputOptions);\n    const userOption = keys.find(key =>\n        userInputOptions[key].includes(formattedInput)\n    );\n    return userOption ? userOption : \"Input inesperado\";\n};\n\nconst formatInput = (userInput) => {\n    const lowerInput = userInput.toLowerCase()\n    const withoutEmojis = removeEmoji(lowerInput)\n    return withoutEmojis.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9\\s]/g, \"\").replace(\"  \", \" \").trim();\n}\n\nconst removeEmoji = (userInput) => {\n    return userInput.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|\\uD83E[\\uDD00-\\uDDFF])/g, '');\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751c1853-a282-4c2f-baaa-c8e05963fae1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"update exceptionErrorCountAskRegistration","$invalid":false,"settings":{"function":"run","source":"const run = (count) => {\n   return count ? parseInt(count) + 1 : 1\n}","inputVariables":["exceptionErrorCountAskRegistration"],"outputVariable":"exceptionErrorCountAskRegistration","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"userInput","values":["Input inesperado"]}]}],"$inputSuggestions":["Sim","N√£o"],"$defaultOutput":{"stateId":"a70c2101-574c-49bf-8a11-dda0dc8d1f6c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"36352ac4-85a2-428a-b4ea-6f5307c0cafc","root":false,"$title":"[finalizacao] Pergunta sobre matricula","$position":{"top":"313px","left":"1285px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c22b56c8-fead-4b1c-9ae5-1fd9c38d39e1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"79c7442f-eebb-432a-b705-16c64b90b0c9","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bab779f8-3017-44b5-991b-6a1b91f9ef7c","typeOfStateId":"state","$connId":"con_403","$id":"ea70070b-ee42-42fd-8b00-7bbf02a02664","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"4e8f60d9-b8a5-47d0-987b-06a49d6177e7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ProcessHttp","$title":"get holidays","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"{{config.apiHolidayBaseUrl}}/{{config.currentYear}}","responseStatusVariable":"holidaysStatus","responseBodyVariable":"holidaysResponse"},"conditions":[]},{"$id":"6b7d2711-61e2-4ae0-b73d-8185662bdc84","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"get todayIsNearAHoliday","$invalid":false,"settings":{"function":"run","source":"const run = (holidaysResponse) => {\n    try {\n        const holidays = JSON.parse(holidaysResponse)\n        const todayIsHoliday = checkIfTodayIsHoliday(holidays)\n        return todayIsHoliday\n    } catch (error) {\n        return false\n    }\n}\n\nconst checkIfTodayIsHoliday = (holidays) => {\n    const today = new Date()\n    const todayStringDate = `${today.getDate()}/${today.getMonth() + 1}`\n    const holiday = holidays.find(holiday => {\n        const [, month, day] = holiday.date.split(\"-\")\n        const holidayStringDate = `${day}/${month}`\n        return todayStringDate == holidayStringDate\n    })\n    return holiday ? true : false\n}","inputVariables":["holidaysResponse"],"outputVariable":"todayIsNearAHoliday","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"bab779f8-3017-44b5-991b-6a1b91f9ef7c","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#7762E3","label":"RequestHttp","id":"blip-tag-c614f341-2284-7d3c-8156-d4be147f5306","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"c22b56c8-fead-4b1c-9ae5-1fd9c38d39e1","root":false,"$title":"[api] Consulta feriados","$position":{"top":"473px","left":"1281px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bab779f8-3017-44b5-991b-6a1b91f9ef7c":{"$contentActions":[{"action":{"$id":"e275d301-3228-4588-b14a-27e152e93cc2","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"102f45e3-ef82-4a33-a19b-f9a9280a5d86","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"102f45e3-ef82-4a33-a19b-f9a9280a5d86","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0264dbe7-a0c9-4d2a-bb30-9e0feb003665","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"798fab8b-89e6-488b-883a-969a2741365c","type":"text/plain","content":"{{registrationDynamicMessage}}","metadata":{}},"$cardContent":{"document":{"id":"798fab8b-89e6-488b-883a-969a2741365c","type":"text/plain","content":"{{registrationDynamicMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b9b5ed8-947b-4ecd-9d8c-c7ac599ee778","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"702ceddf-4c46-45d4-b15d-15b6d228f689","typeOfStateId":"state","$connId":"con_408","$id":"878c701f-fd77-4aeb-bf0c-7412ba0bd120","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"ba41d21b-9d51-49ed-a234-627a7ae8245c","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScript","$title":"registrationDynamicMessage","$invalid":false,"settings":{"function":"run","source":"const run = (todayIsHoliday) => {\n    let defaultMesage = \"Que √≥timo! Vou te encaminhar para um dos nosso consultores te ajudar com a matr√≠cula.\"\n    try {\n        if(todayIsHoliday) return `${defaultMesage}\\n\\nComo estamos perto de um feriado, √© poss√≠vel que algu√©m demore um pouco pra te atender`\n        return defaultMesage\n    } catch (error) {\n        return defaultMesage\n    }\n}","inputVariables":["todayIsNearAHoliday"],"outputVariable":"registrationDynamicMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"702ceddf-4c46-45d4-b15d-15b6d228f689","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false}],"id":"bab779f8-3017-44b5-991b-6a1b91f9ef7c","root":false,"$title":"[finalizacao] Encaminha para finalizar matricula","$position":{"top":"608px","left":"1283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cd7a13d-5d95-45c5-90e8-250635785603":{"$contentActions":[{"action":{"$id":"19841c65-93cc-48bd-8f1b-8c4623d48214","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1c0d91e9-0f2c-4593-a7f3-e7d8acbff00a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1c0d91e9-0f2c-4593-a7f3-e7d8acbff00a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c37b7aa4-9848-4b78-a5a2-bb327f88ef4e","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"1cf14b2c-a997-468c-bbdd-393bb5e56521","type":"text/plain","content":"Ah que pena que decidiu finalizar a nossa conversa!  üòî\nMas tudo bem, caso queira saber sobre as recomenda√ß√µes de cursos, √© s√≥ me chamar.","metadata":{}},"$cardContent":{"document":{"id":"1cf14b2c-a997-468c-bbdd-393bb5e56521","type":"text/plain","content":"Ah que pena que decidiu finalizar a nossa conversa!  üòî\nMas tudo bem, caso queira saber sobre as recomenda√ß√µes de cursos, √© s√≥ me chamar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4eb8e9b6-6bf2-4a44-99c2-e63de44120bc","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"61c84917-b6a9-4106-9f1d-ae83deec2af9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"61c84917-b6a9-4106-9f1d-ae83deec2af9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff95d0a3-d2d7-44dd-a1a1-9d3b55c3037d","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"46bf327f-48f2-4d4e-841b-062e21eb0629","type":"text/plain","content":"At√© mais! üëã","metadata":{}},"$cardContent":{"document":{"id":"46bf327f-48f2-4d4e-841b-062e21eb0629","type":"text/plain","content":"At√© mais! üëã"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a963e64-ba7a-4d32-ac96-7c36bde0b1be","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"1cd7a13d-5d95-45c5-90e8-250635785603","root":false,"$title":"[optout] Decidiu finalizar","$position":{"top":"1895px","left":"300px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"702ceddf-4c46-45d4-b15d-15b6d228f689":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ef0f328b-fadf-4c85-933d-86ce36014d31","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","typeOfStateId":"state","$connId":"con_413","$id":"0b6e659c-1bae-4c3e-820d-3781e5a75722","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"ea574524-f4b0-464b-9d70-36ef7c509ce1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ProcessHttp","$title":"send lead","$invalid":false,"settings":{"headers":{},"method":"POST","body":"{\n    \"name\": \"{{contact.name}}\",\n    \"document\": \"{{cpfValidation@cpf}}\",\n    \"phoneNumber\": \"{{contact.phoneNumber}}\",\n    \"address\": {\n        \"uf\": \"{{address@uf}}\",\n        \"city\": \"{{address@city}}\",\n        \"neighborhood\": \"{{address@neighborhood}}\",\n        \"street\": \"{{address@street}}\"\n    },\n    \"course\": \"{{courseInfos@id}}\",\n    \"discounts\": {\n        \"friendRecommendation\" : \"{{friendRecommendation}}\", \n        \"recurringPayment\": \"{{recurringPayment}}\",\n        \"worksInTheArea\": \"{{worksInTheArea}}\"\n    }\n}","uri":"{{config.baseUrl}}/lead/send","responseStatusVariable":"sendLeadStatus","responseBodyVariable":"sendLeadResponse"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:c05846b4-55b7-437a-954b-7f9d56c93fe9","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-08fa91ed-19f4-b36f-0b56-5db0309ad2f4","canChangeBackground":false},{"background":"#ffa500","label":"ExecuteScript","id":"blip-tag-a20ddacf-9182-3945-f9f4-e9edbdcfc075","canChangeBackground":false},{"background":"#7762E3","label":"RequestHttp","id":"blip-tag-c614f341-2284-7d3c-8156-d4be147f5306","canChangeBackground":false}],"id":"702ceddf-4c46-45d4-b15d-15b6d228f689","root":false,"$title":"[api] Envia dados do lead","$position":{"top":"202px","left":"1468px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}